$(document).ready(function(){

// Base30 export
//asyncTest("Base30 import / export", function() {
//	require(['text!' + ''])
//	.then(function(expectedtext){
//		QUnit.expect(1)
//		
//		QUnit.equal(
//			true
//			, true
//		)
//		
//		QUnit.start()
//	})
//})

test("export tests - native roundtrip", function() {
//	QUnit.expect(1)
	
	var data = [{"x":[172,170,167,164,161,149,144,136,131,104,94,86,71,65,62,55,54,52,49,48,48,48,51,54,63,66,78,82,89,97,103,107,126,129,130,135,139,147,149,152,155,156,159,159,159,159,157,156,156,154,153,151,150,149,148,147,147,147,151,154,162,165,177,183,197,204,209,231,238,271,284,293,315,323,330,340,343,343,339,336,324,317,283,271,263,243,236,214,210,204,199,197,195,196,208,213,231,239,245,264,273,309,326,338,370,382,419,428,441,456,464,475,476,475,468,461,432,418,406,384,378,359,355,351,349,349,350,370,378,417,436,488,501,515,542,553,569,589,626,630,633,634,629,601,591,580,553,542,505,494,485,470,464,459,446,445,447,451,471,479,506,516,545,558,564,579,583,586,591],"y":[280,279,277,275,272,262,258,250,244,203,188,177,155,147,138,123,118,110,95,91,80,77,66,63,56,54,50,50,49,48,48,48,53,56,58,66,73,89,93,99,109,116,137,141,151,155,167,170,174,183,187,199,203,207,213,217,230,233,241,246,251,252,256,257,259,259,259,255,251,235,226,220,200,193,186,167,160,140,132,128,116,112,103,101,101,104,107,119,124,130,140,149,167,172,197,205,221,225,228,234,235,236,236,235,226,221,200,191,180,164,155,127,121,117,105,100,85,81,80,80,81,100,109,122,142,158,168,211,222,254,263,278,279,279,279,276,272,263,224,217,209,183,165,126,117,109,93,87,79,79,79,83,88,93,119,134,172,183,216,224,247,252,271,276,280,286,287,289,291]}]
	var $s = $('#signature').jSignature()
	
	$s.jSignature('setData', data, 'native')
	
	var newdata = $s.jSignature('getData', 'native')
	
	QUnit.deepEqual(
		data
		, newdata
	)
	
	$s.html("").unbind('change')
	
})

test("base30 - internal methods", function() {
	var undef, i, l
	/////
	// making sure arbitrary base (30 in this case) works for number.toString(base)
	/////
	var reference = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "1a", "1b", "1c", "1d", "1e", "1f", "1g", "1h", "1i", "1j", "1k", "1l", "1m", "1n", "1o", "1p", "1q", "1r", "1s", "1t", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "2a", "2b", "2c", "2d", "2e", "2f", "2g", "2h", "2i", "2j", "2k", "2l", "2m", "2n", "2o", "2p", "2q", "2r", "2s", "2t", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39"]
	, actual = [];
	for ( i = 0, l = 100; i < l; i++ ){ actual.push( i.toString(30)) };
	QUnit.deepEqual(
		actual
		, reference
	);

	// making sure debug exposes the internal methods
	// window.jSignatureDebug = {'modulename':{'methodname':methodpointer,...}, ...}
	QUnit.equal(
		( window.jSignatureDebug === undef ? false : true )
		, true
		, "Must have window.jSignatureDebug object with internal methods exposed through it."
	)
	
	/////
	// Testing core of conversion from base10 to base30
	/////

	/////
	// part 1

	
	var remapTailChars = window.jSignatureDebug['base30']['remapTailChars']
	// remap map for base30: 
	// 0123456789abcdefghijklmnopqrst
	// uvwxyzABCDEFGHIJKLMNOPQRSTUVWX
	
	// a = [10,20,30,40,50,77,98,103,234,345,456,567,789,1234,3456]
	// a.map(function(n){return n.toString(30)})
	var input  = ["a", "k", "10", "1a", "1k", "2h", "38", "3d", "7o", "bf", "f6", "ir", "q9", "1b4", "3p6"];
	reference = ["a", "k", "1u", "1E", "1O", "2L", "3C", "3H", "7S", "bJ", "fA", "iV", "qD", "1Fy", "3TA"];
	actual = []; 
	for ( i = 0, l = input.length; i < l; i++ ){ 
		actual.push( 
			remapTailChars(input[i])
		) 
	};
	QUnit.deepEqual(
		actual
		, reference
	);

	/////
	// part 2
	
	var data = [{"x":[172,170,167,164,161,149,144,136,131,104,94,86,71,65,62,55,54,52,49,48,48,48,51,54,63,66,78,82,89,97,103,107,126,129,130,135,139,147,149,152,155,156,159,159,159,159,157,156,156,154,153,151,150,149,148,147,147,147,151,154,162,165,177,183,197,204,209,231,238,271,284,293,315,323,330,340,343,343,339,336,324,317,283,271,263,243,236,214,210,204,199,197,195,196,208,213,231,239,245,264,273,309,326,338,370,382,419,428,441,456,464,475,476,475,468,461,432,418,406,384,378,359,355,351,349,349,350,370,378,417,436,488,501,515,542,553,569,589,626,630,633,634,629,601,591,580,553,542,505,494,485,470,464,459,446,445,447,451,471,479,506,516,545,558,564,579,583,586,591],"y":[280,279,277,275,272,262,258,250,244,203,188,177,155,147,138,123,118,110,95,91,80,77,66,63,56,54,50,50,49,48,48,48,53,56,58,66,73,89,93,99,109,116,137,141,151,155,167,170,174,183,187,199,203,207,213,217,230,233,241,246,251,252,256,257,259,259,259,255,251,235,226,220,200,193,186,167,160,140,132,128,116,112,103,101,101,104,107,119,124,130,140,149,167,172,197,205,221,225,228,234,235,236,236,235,226,221,200,191,180,164,155,127,121,117,105,100,85,81,80,80,81,100,109,122,142,158,168,211,222,254,263,278,279,279,279,276,272,263,224,217,209,183,165,126,117,109,93,87,79,79,79,83,88,93,119,134,172,183,216,224,247,252,271,276,280,286,287,289,291]}]
	var database30 = "5QZ2333c585ra8f637123100Y3393c47864j3154823313000Z210212111100Y4383c6e75m71xd9m87a30Z43c71yc8k7m46522Y1c5i86j91Ahc1wc1B9df8b1Z177tecm6j4420Y1k81Dj1Qderbgk1B431Z5sabrb1Bb9f65d1Y24k8ratd6f435_9EZ1223a4861Ffbm89f58f4b3b372401100Y53287g46a7l4a4c3494c4464d3855141200Z44g96k77j7k84c4920Y33c56a9i5p8g436110Z195l9bg9s64c5f410Y1j9dkga1Hb1w9f100Z3491D78qi1D98g6800Y455qf1Cb1x8n5j546122"
	
	var compressstrokeleg = window.jSignatureDebug['base30']['compressstrokeleg']
	
	var stroke = data[0]
	var strokebase30 = database30.split('_')
	
	QUnit.deepEqual(
		compressstrokeleg(stroke.x)
		, strokebase30[0]
	)	

	QUnit.deepEqual(
		compressstrokeleg(stroke.y)
		, strokebase30[1]
	)	

})

test("export tests - native to base30 roundtrip", function() {
	
	var data = [{"x":[172,170,167,164,161,149,144,136,131,104,94,86,71,65,62,55,54,52,49,48,48,48,51,54,63,66,78,82,89,97,103,107,126,129,130,135,139,147,149,152,155,156,159,159,159,159,157,156,156,154,153,151,150,149,148,147,147,147,151,154,162,165,177,183,197,204,209,231,238,271,284,293,315,323,330,340,343,343,339,336,324,317,283,271,263,243,236,214,210,204,199,197,195,196,208,213,231,239,245,264,273,309,326,338,370,382,419,428,441,456,464,475,476,475,468,461,432,418,406,384,378,359,355,351,349,349,350,370,378,417,436,488,501,515,542,553,569,589,626,630,633,634,629,601,591,580,553,542,505,494,485,470,464,459,446,445,447,451,471,479,506,516,545,558,564,579,583,586,591],"y":[280,279,277,275,272,262,258,250,244,203,188,177,155,147,138,123,118,110,95,91,80,77,66,63,56,54,50,50,49,48,48,48,53,56,58,66,73,89,93,99,109,116,137,141,151,155,167,170,174,183,187,199,203,207,213,217,230,233,241,246,251,252,256,257,259,259,259,255,251,235,226,220,200,193,186,167,160,140,132,128,116,112,103,101,101,104,107,119,124,130,140,149,167,172,197,205,221,225,228,234,235,236,236,235,226,221,200,191,180,164,155,127,121,117,105,100,85,81,80,80,81,100,109,122,142,158,168,211,222,254,263,278,279,279,279,276,272,263,224,217,209,183,165,126,117,109,93,87,79,79,79,83,88,93,119,134,172,183,216,224,247,252,271,276,280,286,287,289,291]}]
	var database30 = "data:image/jsignature;base30,5QZ2333c585ra8f637123100Y3393c47864j3154823313000Z210212111100Y4383c6e75m71xd9m87a30Z43c71yc8k7m46522Y1c5i86j91Ahc1wc1B9df8b1Z177tecm6j4420Y1k81Dj1Qderbgk1B431Z5sabrb1Bb9f65d1Y24k8ratd6f435_9EZ1223a4861Ffbm89f58f4b3b372401100Y53287g46a7l4a4c3494c4464d3855141200Z44g96k77j7k84c4920Y33c56a9i5p8g436110Z195l9bg9s64c5f410Y1j9dkga1Hb1w9f100Z3491D78qi1D98g6800Y455qf1Cb1x8n5j546122"
	
	var $s = $('#signature').jSignature()
	
	$s.jSignature('setData', data, 'native')
	
	var newdata = $s.jSignature('getData', 'base30')
	
	QUnit.deepEqual(
		'data:' + newdata.join(',')
		, database30
	)
	
	$s.jSignature('setData', database30)
	newdata = $s.jSignature('getData', 'native')

	QUnit.deepEqual(
		newdata
		, data
	)
	
	$s.html("").unbind('change')

})

test("export tests - native to SVG", function() {
	var data = [{"x":[172,170,167,164,161,149,144,136,131,104,94,86,71,65,62,55,54,52,49,48,48,48,51,54,63,66,78,82,89,97,103,107,126,129,130,135,139,147,149,152,155,156,159,159,159,159,157,156,156,154,153,151,150,149,148,147,147,147,151,154,162,165,177,183,197,204,209,231,238,271,284,293,315,323,330,340,343,343,339,336,324,317,283,271,263,243,236,214,210,204,199,197,195,196,208,213,231,239,245,264,273,309,326,338,370,382,419,428,441,456,464,475,476,475,468,461,432,418,406,384,378,359,355,351,349,349,350,370,378,417,436,488,501,515,542,553,569,589,626,630,633,634,629,601,591,580,553,542,505,494,485,470,464,459,446,445,447,451,471,479,506,516,545,558,564,579,583,586,591],"y":[280,279,277,275,272,262,258,250,244,203,188,177,155,147,138,123,118,110,95,91,80,77,66,63,56,54,50,50,49,48,48,48,53,56,58,66,73,89,93,99,109,116,137,141,151,155,167,170,174,183,187,199,203,207,213,217,230,233,241,246,251,252,256,257,259,259,259,255,251,235,226,220,200,193,186,167,160,140,132,128,116,112,103,101,101,104,107,119,124,130,140,149,167,172,197,205,221,225,228,234,235,236,236,235,226,221,200,191,180,164,155,127,121,117,105,100,85,81,80,80,81,100,109,122,142,158,168,211,222,254,263,278,279,279,279,276,272,263,224,217,209,183,165,126,117,109,93,87,79,79,79,83,88,93,119,134,172,183,216,224,247,252,271,276,280,286,287,289,291]}]
	var dataSVG = "data:image/svg+xml,<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"><svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" width=\"588\" height=\"245\"><path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-width=\"3\" stroke=\"rgb(0, 0, 0)\" fill=\"none\" d=\"M 125 233 c -0.14 -0.09 -5.52 -3.05 -8 -5 c -6.89 -5.41 -13.56 -10.95 -20 -17 c -4.69 -4.41 -9.32 -8.84 -13 -14 c -12.94 -18.12 -23.92 -36.77 -37 -56 c -9.79 -14.39 -20.59 -26.99 -29 -41 c -4.35 -7.25 -7.51 -15.79 -10 -24 c -3.14 -10.34 -5.39 -21.44 -7 -32 c -0.69 -4.51 -0.53 -9.55 0 -14 c 0.44 -3.63 1.03 -8.49 3 -11 c 3.31 -4.23 9.87 -8.96 15 -12 c 3.38 -2 7.97 -3.41 12 -4 c 9.26 -1.35 19.9 -2.57 29 -2 c 6.15 0.38 13.62 3.05 19 5 c 1.16 0.42 2.26 1.86 3 3 c 3.46 5.32 6.81 11.04 10 17 c 4.69 8.78 9.09 17.21 13 26 c 1.4 3.16 2.37 6.58 3 10 c 1.71 9.27 3.18 18.58 4 28 c 0.52 5.99 0.88 12.15 0 18 c -3.08 20.53 -8.84 41.48 -12 62 c -0.8 5.2 -1.11 11.41 0 16 c 1.02 4.23 4.24 9.68 7 13 c 1.77 2.12 5.2 3.78 8 5 c 4.69 2.04 9.9 3.83 15 5 c 6.52 1.49 13.29 2.37 20 3 c 3.98 0.37 8.07 0.46 12 0 c 7.33 -0.86 15.36 -1.43 22 -4 c 13.28 -5.14 26.95 -12.64 40 -20 c 7.77 -4.38 15.16 -9.32 22 -15 c 12.91 -10.72 27.05 -22.05 37 -34 c 5.76 -6.91 10.64 -17.65 13 -26 c 1.62 -5.74 0.84 -14.09 0 -20 c -0.38 -2.64 -2.24 -5.77 -4 -8 c -4.33 -5.46 -9.86 -11.33 -15 -16 c -1.89 -1.72 -4.53 -3.22 -7 -4 c -10.76 -3.41 -22.38 -6.22 -34 -9 c -4.02 -0.96 -7.99 -1.6 -12 -2 c -2.64 -0.26 -5.35 -0.28 -8 0 c -6.7 0.72 -14.05 0.81 -20 3 c -9.61 3.53 -20.57 9.38 -29 15 c -3.84 2.56 -7.24 7.14 -10 11 c -2.08 2.91 -4.17 6.58 -5 10 c -2.03 8.35 -3.21 18.53 -4 27 c -0.15 1.58 0.35 3.49 1 5 c 3.55 8.2 7.71 16.68 12 25 c 1.46 2.83 2.92 5.83 5 8 c 5.3 5.53 11.73 11.49 18 16 c 4.08 2.93 9.16 5.09 14 7 c 6.16 2.43 12.66 5.21 19 6 c 14.34 1.79 29.63 1.79 45 2 c 9.9 0.13 19.74 0.52 29 -1 c 10.61 -1.74 21.34 -5.61 32 -9 c 4.17 -1.33 8.14 -2.95 12 -5 c 12.64 -6.71 25.63 -13.1 37 -21 c 7.94 -5.52 14.85 -12.85 22 -20 c 8.17 -8.17 17.34 -16.17 23 -25 c 5.02 -7.82 7.73 -18.73 11 -28 c 0.66 -1.87 1 -4.15 1 -6 c 0 -1.25 -0.41 -2.83 -1 -4 c -1.98 -3.96 -4.32 -8.75 -7 -12 c -1.66 -2.01 -4.49 -3.6 -7 -5 c -9.53 -5.3 -19.21 -10.67 -29 -15 c -4.37 -1.93 -9.31 -3.1 -14 -4 c -3.88 -0.75 -7.9 -0.88 -12 -1 c -7.49 -0.22 -14.71 -0.26 -22 0 c -2.02 0.07 -4.67 -0.07 -6 1 c -5.89 4.72 -14.55 12.24 -19 19 c -3.88 5.89 -6.25 14.66 -8 22 c -1.5 6.3 -1.85 13.28 -2 20 c -0.19 8.7 -1.32 18.39 1 26 c 4.22 13.87 12.83 29.17 20 43 c 2.06 3.97 4.77 8.05 8 11 c 11.97 10.95 25.71 22.6 39 32 c 5.54 3.92 12.39 6.76 19 9 c 17.02 5.75 34.8 10.77 52 15 c 4.14 1.02 8.55 0.92 13 1 c 14 0.26 27.88 1.35 41 0 c 8.93 -0.92 18.26 -4.02 27 -7 c 6.88 -2.34 14.86 -4.67 20 -9 c 12.61 -10.62 25.44 -26.03 37 -39 c 1.73 -1.95 2.87 -4.57 4 -7 c 1.2 -2.57 2.69 -5.33 3 -8 c 0.96 -8.12 1.74 -17.82 1 -26 c -0.53 -5.87 -2.09 -12.97 -5 -18 c -7.48 -12.91 -18.28 -26.73 -28 -39 c -2.72 -3.44 -6.46 -6.14 -10 -9 c -3.58 -2.9 -7.07 -5.6 -11 -8 c -12.67 -7.76 -25.15 -16.86 -38 -22 c -11.08 -4.43 -24.77 -6.28 -37 -8 c -6.46 -0.91 -13.62 -0.73 -20 0 c -4.95 0.57 -10.7 2.16 -15 4 c -2.17 0.93 -4.04 3.21 -6 5 c -1.78 1.62 -3.88 3.08 -5 5 c -4.59 7.9 -10.13 17.59 -13 26 c -1.49 4.35 -1.1 9.94 -1 15 c 0.24 12.81 0.53 26.03 2 38 c 0.45 3.68 2.16 7.63 4 11 c 6.06 11.12 12.04 23.74 20 33 c 9.64 11.22 23.28 21.63 35 31 c 2.8 2.24 6.79 3.03 10 5 c 9.95 6.12 18.82 13.7 29 19 l 46 20\"/></svg>"

	
	var $s = $('#signature').jSignature()

	$s.jSignature('setData', data, 'native')

	var newData = $s.jSignature('getData', 'svg')

	QUnit.deepEqual(
		'data:' + newData.join(',')
		, dataSVG
	)

	$s.html("").unbind('change')
})

}) // end of document.ready(